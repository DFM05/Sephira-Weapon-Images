<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ›è²è‰å¨…æ­¦å™¨æŠ•ç¥¨ - å…¨æœå®æ—¶æ¦œå•</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; text-align: center; padding: 20px; }
        .container { display: flex; justify-content: center; gap: 20px; margin-top: 30px; flex-wrap: wrap; }
        .card { background: #1e293b; padding: 20px; border-radius: 15px; width: 250px; cursor: pointer; border: 2px solid transparent; transition: 0.3s; position: relative; }
        .card:hover { border-color: #fbbf24; transform: translateY(-5px); }
        .card.loading { opacity: 0.5; pointer-events: none; }
        img { width: 100%; height: 200px; object-fit: contain; background: #000; border-radius: 10px; }
        .vs { font-size: 2rem; font-weight: bold; color: #ef4444; align-self: center; }
        #progress { color: #94a3b8; margin-bottom: 20px; }
        /* æ–°å¢æŒ‰é’®æ ·å¼ */
        .rank-btn { 
            background: #fbbf24; 
            color: #0f172a; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            font-weight: bold; 
            cursor: pointer; 
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            transition: 0.2s;
        }
        .rank-btn:hover { background: #f59e0b; transform: scale(1.05); }
    </style>
</head>
<body>
    <h1>èµ›è²è‰å¨…ï¼šå“ªæŠŠæ­¦å™¨æ›´å¼ºï¼Ÿ</h1>
    
    <a href="rank.html" class="rank-btn">ğŸ† æŸ¥çœ‹å…¨æœå®æ—¶æ¦œå•</a>
    
    <p id="progress" style="margin-top: 20px;">æ­£åœ¨è¿æ¥æ•°æ®åº“...</p>
    
    <div class="container">
        <div class="card" id="card1" onclick="vote(1)">
            <img id="img1" src="">
            <p id="name1">åŠ è½½ä¸­...</p>
        </div>
        <div class="vs">VS</div>
        <div class="card" id="card2" onclick="vote(2)">
            <img id="img2" src="">
            <p id="name2">åŠ è½½ä¸­...</p>
        </div>
    </div>

<script>
    // ======= 1. é…ç½®ä¿¡æ¯ =======
    const SUPABASE_URL = "https://qdrqekpzaexmkyckhjlw.supabase.co"; 
    const SUPABASE_KEY = "sb_publishable_YivlajEIEQghleyC0hxBYQ_X7AihGf_M4yK03m_Wz-fW-E5T2v-0"; 
    
    const githubUser = "DFM05";
    const repoName = "Sephira-Weapon-Images";
    // ==========================

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    let count = 1;
    let id1, id2;
    const weaponNames = ["å¸Œæœ›çš„å½±å­","æ— å…‰ä¹‹åˆƒ","çˆ¬è¡Œç»æœ›","ç‚™çƒ­ä¹‹åˆƒ","ç¬¼ç½©çš„é˜´äº‘","ç¦å¯¿è‰","ç™½è‰²å¾®ç¬‘","ç»å¯¹å‘å¾€","è‰°éš¾å®éªŒ","ç‡ƒçƒ§ä¹‹ç‰™","é›·ç”µä¹‹æ€’","æ— å°½æ²‰æµ¸","é»‘å¹•","é»˜æ€","çŸ­æš‚è‡ªè´£","è†æ£˜æ£’","å±å˜çš„è„Šæ¤","ä¸‡å¹´å¯’éœœå·¨å‰‘","æ·±çº¢æ¼©æ¶¡","ç”µå‡»å¤§å‰‘ã€E3Gã€‘","å¹»æœ¯å¸ˆçš„é—äº§","çˆ±çš„çœ¼ç¥","é¡½çš®çš„æ¶ä½œå‰§","å†°æŸ±å‰‘","è£åˆ¤å®˜","ç”µå‡»å¤§å‰‘ã€S3Gã€‘","å¤ªåˆå½¢æ€","é©±é­”çš„é‡å‰‘","æ‹‰æ‰é‡Œæ©","çº¢è›‡ç¢å‡»","ç´¢åˆ©æ–¯ç°çƒ¬","æ˜Ÿå…‰é—ªçƒ","ç°çƒ¬é£˜æ‰¬","æ”¶ç´§çš„ææƒ§","èƒ¡èåœå‰‘","é—ªå…‰çš„ç»†å‰‘","ç«ç„°å‡è§†","å†°å·ä¹‹åˆƒ","å¼©ç‚®å‰‘","å†°å†·æ„¤æ€’","æ— å åŸé‡","è‘±æ ¹å‰‘","å†°ä¹‹å‘¼å¸","æš´é£é›ªçš„å‰å¥","è¶…å¯¼ä½“","é›·ç”µä¹‹ç¿¼çš„æŒ¯åŠ¨","é‡å‹å¼©ï¼šåŠ é€Ÿæ ¸å¿ƒ","é‡å‹å¼©ï¼šç«è¯åˆæˆ","é‡å‹å¼©ï¼šè¿å‘è£…ç½®","é‡å‹å¼©ï¼šé…å¤‡åˆ¶å¯¼æ¨¡å—","é‡å‹å¼©ï¼šæ ‡è®°ç¨³å®šåŒ–","é‡å‹å¼©ï¼šé€Ÿå†»ç»“æ™¶","å¼©ï¼šåŒå­","é‡å‹å¼©ï¼šçˆ†ç‚¸è£…ç½®","è¿·ä½ åŠ å†œç‚®","é‡å‹å¼©ï¼šèšäº‘è€…","é‡å‹å¼©ï¼šæ‰©å±•è£…ç½®","å¡é‡Œå§†çš„å½¢è±¡","ååˆ€ã€æ‘æ­£ã€‘","æ€ªåˆ€ã€æ¯«ç¾½ã€‘","ç‚½ç„°èµ«å°”å·´åŠªæ–¯","æµ·è’‚","å‰‘æ–©åˆ€ï¼šé£æŸ³","æ–©å‰‘åˆ€ï¼šç ´èˆ","ä¼˜è¡£çš„çŸ­åŒ•é¦–","äºšè¾¾ç›çš„èª“çº¦","å›¾ä¹¦é¦†å¹½çµå°å°ç ”ç©¶ä¼šç¬¬2å‹","æ°¸éœœçš„æ²‰é»˜","çº³æ–¯ç‰¹æœ—çš„ç¢ç‰‡","ç”µå…‰ä¸€åˆ»"];

    async function refresh() {
        if (count > 50) {
            alert("æ„Ÿè°¢å‚ä¸ï¼50è½®æŠ•ç¥¨å·²å®Œæˆã€‚");
            window.location.href = 'rank.html'; // 50è½®æŠ•å®Œè‡ªåŠ¨è·³åˆ°æ’è¡Œæ¦œ
            return;
        }
        
        document.getElementById('progress').innerText = `è¿›åº¦: ${count} / 50`;
        
        id1 = Math.floor(Math.random() * 70) + 1;
        do { id2 = Math.floor(Math.random() * 70) + 1; } while(id1 === id2);

        document.getElementById('img1').src = `https://raw.githubusercontent.com/${githubUser}/${repoName}/main/${id1}.png`;
        document.getElementById('img2').src = `https://raw.githubusercontent.com/${githubUser}/${repoName}/main/${id2}.png`;
        document.getElementById('name1').innerText = weaponNames[id1 - 1] || `æ­¦å™¨ #${id1}`;
        document.getElementById('name2').innerText = weaponNames[id2 - 1] || `æ­¦å™¨ #${id2}`;
        
        await supabaseClient.rpc('increment_views', { ids: [id1, id2] });
    }

    async function vote(choice) {
        const winnerId = (choice === 1) ? id1 : id2;
        document.getElementById('card1').classList.add('loading');
        document.getElementById('card2').classList.add('loading');

        await supabaseClient.rpc('increment_votes', { winner_id: winnerId });

        count++;
        document.getElementById('card1').classList.remove('loading');
        document.getElementById('card2').classList.remove('loading');
        refresh();
    }

    refresh();
</script>
</body>
</html>