<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>èµ›è²è‰å¨…æ­¦å™¨å¼ºåº¦æ¦œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* é¡µé¢æ ·å¼ä¿æŒä¸“ä¸šä¸ç®€æ´ */
        body { font-family: sans-serif; background: #0f172a; color: white; text-align: center; padding: 20px; }
        table { margin: 20px auto; border-collapse: collapse; width: 90%; max-width: 900px; background: #1e293b; border-radius: 10px; overflow: hidden; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        th, td { padding: 15px; border-bottom: 1px solid #334155; }
        th { background: #334155; color: #fbbf24; text-transform: uppercase; letter-spacing: 0.05em; }
        tr:hover { background: #2d3748; }
        .win-rate { font-weight: bold; color: #4ade80; }
        .back-btn { background: #fbbf24; color: #0f172a; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-weight: bold; display: inline-block; margin-bottom: 20px; transition: 0.2s; }
        .back-btn:hover { background: #f59e0b; transform: scale(1.05); }
    </style>
</head>
<body>
    <h1>ğŸ† èµ›è²è‰å¨…ï¼šæ­¦å™¨å¼ºåº¦æ’è¡Œæ¦œ</h1>
    <p style="color: #94a3b8; margin-bottom: 30px;">åŸºäºå…¨æœç©å®¶çœŸå®å¯¹æˆ˜æŠ•ç¥¨æ•°æ® (æŒ‰èƒœç‡æ’å)</p>
    
    <a href="index.html" class="back-btn">â¬… è¿”å›æŠ•ç¥¨é¡µç»§ç»­æˆ˜æ–—</a>
    
    <table id="rankTable">
        <thead>
            <tr>
                <th>æ’å</th>
                <th>æ­¦å™¨åç§°</th>
                <th>èƒœåœº / å±•ç¤º</th>
                <th>èƒœç‡</th>
            </tr>
        </thead>
        <tbody id="rankBody">
            <tr><td colspan="4">æ­£åœ¨åŒæ­¥å…¨æœèƒœç‡æ•°æ®...</td></tr>
        </tbody>
    </table>

<script>
    // ======= æ ¸å¿ƒé…ç½® (å¿…é¡»ä¸ index.html ä¿æŒä¸€æ¨¡ä¸€æ ·) =======
    const SUPABASE_URL = "https://qdrqekpzaexmkyckhjlw.supabase.co"; 
    const SUPABASE_KEY = "sb_publishable_T_1y4nw8BxsQjxo2ZNWeCg_oM1W_wLD"; 
    // ======================================================

    // æ­¦å™¨çœŸåæ˜ å°„è¡¨
    const weaponNames = ["å¸Œæœ›çš„å½±å­","æ— å…‰ä¹‹åˆƒ","çˆ¬è¡Œç»æœ›","ç‚™çƒ­ä¹‹åˆƒ","ç¬¼ç½©çš„é˜´äº‘","ç¦å¯¿è‰","ç™½è‰²å¾®ç¬‘","ç»å¯¹å‘å¾€","è‰°éš¾å®éªŒ","ç‡ƒçƒ§ä¹‹ç‰™","é›·ç”µä¹‹æ€’","æ— å°½æ²‰æµ¸","é»‘å¹•","é»˜æ€","çŸ­æš‚è‡ªè´£","è†æ£˜æ£’","å±å˜çš„è„Šæ¤","ä¸‡å¹´å¯’éœœå·¨å‰‘","æ·±çº¢æ¼©æ¶¡","ç”µå‡»å¤§å‰‘ã€E3Gã€‘","å¹»æœ¯å¸ˆçš„é—äº§","çˆ±çš„çœ¼ç¥","é¡½çš®çš„æ¶ä½œå‰§","å†°æŸ±å‰‘","è£åˆ¤å®˜","ç”µå‡»å¤§å‰‘ã€S3Gã€‘","å¤ªåˆå½¢æ€","é©±é­”çš„é‡å‰‘","æ‹‰æ‰é‡Œæ©","çº¢è›‡ç¢å‡»","ç´¢åˆ©æ–¯ç°çƒ¬","æ˜Ÿå…‰é—ªçƒ","ç°çƒ¬é£˜æ‰¬","æ”¶ç´§çš„ææƒ§","èƒ¡èåœå‰‘","é—ªå…‰çš„ç»†å‰‘","ç«ç„°å‡è§†","å†°å·ä¹‹åˆƒ","å¼©ç‚®å‰‘","å†°å†·æ„¤æ€’","æ— å åŸé‡","è‘±æ ¹å‰‘","å†°ä¹‹å‘¼å¸","æš´é£é›ªçš„å‰å¥","è¶…å¯¼ä½“","é›·ç”µä¹‹ç¿¼çš„æŒ¯åŠ¨","é‡å‹å¼©ï¼šåŠ é€Ÿæ ¸å¿ƒ","é‡å‹å¼©ï¼šç«è¯åˆæˆ","é‡å‹å¼©ï¼šè¿å‘è£…ç½®","é‡å‹å¼©ï¼šé…å¤‡åˆ¶å¯¼æ¨¡å—","é‡å‹å¼©ï¼šæ ‡è®°ç¨³å®šåŒ–","é‡å‹å¼©ï¼šé€Ÿå†»ç»“æ™¶","å¼©ï¼šåŒå­","é‡å‹å¼©ï¼šçˆ†ç‚¸è£…ç½®","è¿·ä½ åŠ å†œç‚®","é‡å‹å¼©ï¼šèšäº‘è€…","é‡å‹å¼©ï¼šæ‰©å±•è£…ç½®","å¡é‡Œå§†çš„å½¢è±¡","ååˆ€ã€æ‘æ­£ã€‘","æ€ªåˆ€ã€æ¯«ç¾½ã€‘","ç‚½ç„°èµ«å°”å·´åŠªæ–¯","æµ·è’‚","å‰‘æ–©åˆ€ï¼šé£æŸ³","æ–©å‰‘åˆ€ï¼šç ´èˆ","ä¼˜è¡£çš„çŸ­åŒ•é¦–","äºšè¾¾ç›çš„èª“çº¦","å›¾ä¹¦é¦†å¹½çµå°å°ç ”ç©¶ä¼šç¬¬2å‹","æ°¸éœœçš„æ²‰é»˜","çº³æ–¯ç‰¹æœ—çš„ç¢ç‰‡","ç”µå…‰ä¸€åˆ»"];

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function loadRank() {
        // ä»æ•°æ®åº“ weapons è¡¨è·å–æœ€æ–°æ•°æ®
        const { data, error } = await supabaseClient.from('weapons').select('*');

        if (error) {
            document.getElementById('rankBody').innerHTML = `<tr><td colspan="4" style="color:#ef4444;">æ•°æ®åŒæ­¥å¤±è´¥: ${error.message}</td></tr>`;
            return;
        }

        // è®¡ç®—èƒœç‡ã€æ ¼å¼åŒ–æ•°æ®å¹¶æŒ‰èƒœç‡é™åºæ’åˆ—
        const sortedData = data.map(w => {
            const winCount = w.votes_won || 0;
            const viewCount = w.total_views || 0;
            const rate = viewCount > 0 ? ((winCount / viewCount) * 100).toFixed(1) : "0.0";
            return { ...w, winCount, viewCount, rate: parseFloat(rate) };
        }).sort((a, b) => b.rate - a.rate);

        let html = "";
        sortedData.forEach((w, index) => {
            // é€šè¿‡ ID å°†æ•°æ®åº“ä¸­çš„ç¼–å·æ˜ å°„ä¸ºçœŸå
            const realName = weaponNames[w.id - 1] || w.name;
            html += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${realName}</td>
                    <td>${w.winCount} / ${w.viewCount}</td>
                    <td class="win-rate">${w.rate}%</td>
                </tr>
            `;
        });
        document.getElementById('rankBody').innerHTML = html;
    }

    loadRank();
</script>
</body>
</html>